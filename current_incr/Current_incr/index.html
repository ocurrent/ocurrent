<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Current_incr (current_incr.Current_incr)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">current_incr</a> &#x00BB; Current_incr</nav><h1>Module <code>Current_incr</code></h1><p>A simple library for incremental computations. Based on &quot;Adaptive Functional Programming&quot; https://www.cs.cmu.edu/~guyb/papers/popl02.pdf</p><p>The basic idea is:</p><ul><li>You run a computation, which produces a result.</li><li>The library records information about the dependencies of the result.</li><li>You can then change one or more inputs and it will rerun just the parts of the computation that are needed to update the result.</li></ul><p>It is similar to Jane Street's &quot;incremental&quot; library, but much smaller and has no external dependencies.</p><p>It is also similar to &quot;react&quot;, but the results do not depend on the behaviour of the garbage collector. In particular, functions stop being called as soon as they are no longer needed, and cannot be called with &quot;impossible&quot; inputs.</p><nav class="toc"><ul><li><a href="#changeable-values">Changeable values</a></li><li><a href="#changeable-computations">Changeable computations</a></li><li><a href="#external-operations">External operations</a></li></ul></nav></header><section><header><h3 id="changeable-values"><a href="#changeable-values" class="anchor"></a>Changeable values</h3></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>'a t</span></code></dt><dd><p>An <code>'a t</code> holds a value of type <code>'a</code>, which will update as necessary.</p></dd></dl><dl><dt class="spec value" id="val-const"><a href="#val-const" class="anchor"></a><code><span class="keyword">val</span> const : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>const x</code> is the constant value <code>x</code>.</p></dd></dl></section><section><header><h3 id="changeable-computations"><a href="#changeable-computations" class="anchor"></a>Changeable computations</h3></header><dl><dt class="spec type" id="type-cc"><a href="#type-cc" class="anchor"></a><code><span class="keyword">type</span> <span>'a cc</span></code></dt><dd><p>An <code>'a cc</code> is a changable computation that can be run to get a value of type <code>'a</code>. Internally, it is a function that takes a destination variable, reads zero or more other changable values, and then updates the destination.</p></dd></dl><dl><dt class="spec value" id="val-read"><a href="#val-read" class="anchor"></a><code><span class="keyword">val</span> read : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-cc">cc</a></span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-cc">cc</a></span></code></dt><dd><p><code>read x f</code> is a computation that depends on <code>x</code>. <code>f</code> will be called as necessary to ensure that the result stays up-to-date with changes in <code>x</code>.</p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : <span>?&#8288;eq:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-cc">cc</a></span></code></dt><dd><p><code>write x</code> is a computation that always returns <code>x</code>.</p><dl><dt>parameter eq</dt><dd><p>If <code>eq old_value x = true</code> then the new value is considered equal and no update is done. The default is <code>(==)</code>. It is always safe (though inefficient) to return <code>false</code> here.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-of_cc"><a href="#val-of_cc" class="anchor"></a><code><span class="keyword">val</span> of_cc : <span><span class="type-var">'a</span> <a href="index.html#type-cc">cc</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>of_cc x</code> is a changeable value holding the result of evaluating <code>x</code>.</p></dd></dl><dl><dt class="spec value" id="val-on_release"><a href="#val-on_release" class="anchor"></a><code><span class="keyword">val</span> on_release : <span>(unit <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>on_release fn</code> calls <code>fn</code> if the current computation has to be redone. This may be useful to release external resources when they are no longer needed. Note that the order in which multiple such functions are called is somewhat unpredictable.</p></dd></dl><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'b</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>A convenience function to read a value, apply a function to it, and write the result.</p></dd></dl><div class="spec module" id="module-Separate"><a href="#module-Separate" class="anchor"></a><code><span class="keyword">module</span> <a href="Separate/index.html">Separate</a> : <span class="keyword">functor</span> (<a href="Separate/index.html#argument-1-Map">Map</a> : Stdlib.Map.S) <span>&#45;&gt;</span> <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section><section><header><h3 id="external-operations"><a href="#external-operations" class="anchor"></a>External operations</h3><p>These functions are used to interface between the changeable system and other systems (e.g. Lwt).</p></header><dl><dt class="spec type" id="type-var"><a href="#type-var" class="anchor"></a><code><span class="keyword">type</span> <span>'a var</span></code></dt><dd><p>A mutable value that can be changed using <code>change</code>. Internally, <code>type 'a var = 'a t</code>, but it's useful to distinguish between values that are inputs to the system and values that only change in response to computations being rerun.</p></dd></dl><dl><dt class="spec value" id="val-var"><a href="#val-var" class="anchor"></a><code><span class="keyword">val</span> var : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-var">var</a></span></code></dt><dd><p><code>var x</code> creates a new variable initially set to <code>x</code>.</p></dd></dl><dl><dt class="spec value" id="val-of_var"><a href="#val-of_var" class="anchor"></a><code><span class="keyword">val</span> of_var : <span><span class="type-var">'a</span> <a href="index.html#type-var">var</a></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>of_var x</code> casts <code>x</code> to <code>'a t</code>.</p></dd></dl><dl><dt class="spec value" id="val-change"><a href="#val-change" class="anchor"></a><code><span class="keyword">val</span> change : <span>?&#8288;eq:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> <a href="index.html#type-var">var</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>change x v</code> sets the current value of <code>x</code> to <code>v</code> and adds anything that depends on it to the rebuild queue. You must call <code>propagate</code> after this to update everything (you can change several things together and then call <code>propagate</code> once). This function can only be used from the top-level, not from within a computation.</p></dd></dl><dl><dt class="spec value" id="val-propagate"><a href="#val-propagate" class="anchor"></a><code><span class="keyword">val</span> propagate : unit <span>&#45;&gt;</span> unit</code></dt><dd><p>Apply all changes made with <code>change</code>, so that everything is up-to-date.</p></dd></dl><dl><dt class="spec value" id="val-observe"><a href="#val-observe" class="anchor"></a><code><span class="keyword">val</span> observe : <span><span class="type-var">'a</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>observe t</code> is the current value of <code>t</code>. If <code>change</code> has been used then the value may be stale until <code>propagate</code> is called.</p></dd></dl></section></div></body></html>