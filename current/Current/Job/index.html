<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Job (current.Current.Job)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc %%VERSION%%"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">current</a> &#x00BB; <a href="../index.html">Current</a> &#x00BB; Job</nav><h1>Module <code>Current.Job</code></h1></header><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> t</code></dt></dl><dl><dt class="spec value" id="val-create"><a href="#val-create" class="anchor"></a><code><span class="keyword">val</span> create : <span>switch:<a href="../Switch/index.html#type-t">Switch.t</a></span> <span>&#45;&gt;</span> <span>label:string</span> <span>&#45;&gt;</span> <span>config:<a href="../Config/index.html#type-t">Config.t</a></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>create ~switch ~label ~config ()</code> is a new job.</p><dl><dt>parameter switch</dt><dd><p>Turning this off will cancel the job.</p></dd></dl><dl><dt>parameter label</dt><dd><p>A label to use in the job's filename (for debugging).</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-start"><a href="#val-start" class="anchor"></a><code><span class="keyword">val</span> start : <span>?&#8288;timeout:Duration.t</span> <span>&#45;&gt;</span> <span>?&#8288;pool:<a href="../Pool/index.html#type-t">Pool.t</a></span> <span>&#45;&gt;</span> <span>level:<a href="../Level/index.html#type-t">Level.t</a></span> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>start t ~level</code> marks <code>t</code> as running. This can only be called once per job. If confirmation has been configured for <code>level</code>, then this will wait for confirmation first.</p><dl><dt>parameter timeout</dt><dd><p>If given, the job will be cancelled automatically after this period of time.</p></dd></dl><dl><dt>parameter pool</dt><dd><p>If given, the job cannot start until a pool resource is available. The resource is freed when the job finishes.</p></dd></dl></dd></dl><dl><dt class="spec value" id="val-start_time"><a href="#val-start_time" class="anchor"></a><code><span class="keyword">val</span> start_time : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>float Lwt.t</span></code></dt><dd><p><code>start_time t</code> is the time when <code>start</code> was called, or an unresolved promise for it if <code>start</code> hasn't been called yet.</p></dd></dl><dl><dt class="spec value" id="val-write"><a href="#val-write" class="anchor"></a><code><span class="keyword">val</span> write : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>write t data</code> appends <code>data</code> to the log.</p></dd></dl><dl><dt class="spec value" id="val-log"><a href="#val-log" class="anchor"></a><code><span class="keyword">val</span> log : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, Stdlib.Format.formatter, unit, unit)</span> Stdlib.format4</span> <span>&#45;&gt;</span> <span class="type-var">'a</span></code></dt><dd><p><code>log t fmt</code> appends a formatted message to the log, with a newline added at the end.</p></dd></dl><dl><dt class="spec value" id="val-id"><a href="#val-id" class="anchor"></a><code><span class="keyword">val</span> id : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="../index.html#type-job_id">job_id</a></code></dt><dd><p><code>id t</code> is the unique identifier for this job.</p></dd></dl><dl><dt class="spec value" id="val-log_path"><a href="#val-log_path" class="anchor"></a><code><span class="keyword">val</span> log_path : <a href="../index.html#type-job_id">job_id</a> <span>&#45;&gt;</span> <span>Fpath.t <a href="../index.html#type-or_error">or_error</a></span></code></dt><dd><p><code>log_path id</code> is the path of the log for job <code>id</code>, if valid.</p></dd></dl><dl><dt class="spec value" id="val-pp_id"><a href="#val-pp_id" class="anchor"></a><code><span class="keyword">val</span> pp_id : <span><a href="../index.html#type-job_id">job_id</a> Fmt.t</span></code></dt><dt class="spec value" id="val-is_running"><a href="#val-is_running" class="anchor"></a><code><span class="keyword">val</span> is_running : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p><code>is_running t</code> is true if the log file is still open.</p></dd></dl><dl><dt class="spec value" id="val-wait_for_log_data"><a href="#val-wait_for_log_data" class="anchor"></a><code><span class="keyword">val</span> wait_for_log_data : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>wait_for_log_data t</code> is a promise that resolves the next time log data is written or the log is closed.</p></dd></dl><dl><dt class="spec value" id="val-lookup_running"><a href="#val-lookup_running" class="anchor"></a><code><span class="keyword">val</span> lookup_running : <a href="../index.html#type-job_id">job_id</a> <span>&#45;&gt;</span> <span><a href="index.html#type-t">t</a> option</span></code></dt><dd><p>If <code>lookup_running job_id</code> is the job <code>j</code> with id <code>job_id</code>, if <code>is_running j</code>.</p></dd></dl><dl><dt class="spec value" id="val-approve_early_start"><a href="#val-approve_early_start" class="anchor"></a><code><span class="keyword">val</span> approve_early_start : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> unit</code></dt><dd><p><code>approve_early_start t</code> marks the job as approved to start even if the global confirmation threshold would otherwise prevent it. Calling this more than once has no effect.</p></dd></dl><dl><dt class="spec value" id="val-is_waiting_for_confirmation"><a href="#val-is_waiting_for_confirmation" class="anchor"></a><code><span class="keyword">val</span> is_waiting_for_confirmation : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> bool</code></dt><dd><p>Indicates whether the job would benefit from <code>approve_early_start</code> being called.</p></dd></dl><dl><dt class="spec value" id="val-on_cancel"><a href="#val-on_cancel" class="anchor"></a><code><span class="keyword">val</span> on_cancel : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>(string <span>&#45;&gt;</span> <span>unit Lwt.t</span>)</span> <span>&#45;&gt;</span> <span>unit Lwt.t</span></code></dt><dd><p><code>on_cancel t fn</code> calls <code>fn reason</code> if the job is cancelled. If the job has already been cancelled, <code>fn</code> is called immediately. If a job finishes without being cancelled, the cancel hooks are run at the end anyway.</p></dd></dl><dl><dt class="spec value" id="val-with_handler"><a href="#val-with_handler" class="anchor"></a><code><span class="keyword">val</span> with_handler : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>on_cancel:<span>(string <span>&#45;&gt;</span> <span>unit Lwt.t</span>)</span></span> <span>&#45;&gt;</span> <span>(unit <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span>)</span> <span>&#45;&gt;</span> <span><span class="type-var">'a</span> Lwt.t</span></code></dt><dd><p><code>with_handler t ~on_cancel fn</code> is like <code>fn ()</code>, but if the job is cancelled while <code>fn</code> is running then <code>on_cancel reason</code> is called. Even if cancelled, <code>fn</code> is still run to completion. If the job has already been cancelled then <code>fn reason</code> is called immediately (but <code>fn</code> still runs).</p></dd></dl><dl><dt class="spec value" id="val-cancel"><a href="#val-cancel" class="anchor"></a><code><span class="keyword">val</span> cancel : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> unit</code></dt><dd><p><code>cancel msg</code> requests that <code>t</code> be cancelled. This runs all registered cancel hooks and marks the job as cancelled. If the job is already cancelled, this has no effect.</p></dd></dl><dl><dt class="spec value" id="val-cancelled_state"><a href="#val-cancelled_state" class="anchor"></a><code><span class="keyword">val</span> cancelled_state : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <span>unit <a href="../index.html#type-or_error">or_error</a></span></code></dt><dd><p><code>cancelled_state t</code> is <code>Ok ()</code> if the job hasn't been cancelled, or <code>Error (`Msg reason)</code> if it has. This should not be used after the switch has been turned off.</p></dd></dl></div></body></html>